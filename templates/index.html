<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="static/styles_menu.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.10.0/d3.min.js"></script>
  <script>
    d3version4 = d3
    window.d3 = null
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
  <script>
    d3version3 = d3
    window.d3 = null
    // test it worked
    console.log('v3', d3version3.version)
    console.log('v4', d3version4.version)
    d3 = d3version4
  </script>
   <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
      <!-- <script src = "static/bar.js" ></script>
      <script src = "static/donut.js" ></script> -->
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
        <link rel="stylesheet" href="static/donut.css">
        <script src="static/multi_line_chart.js"></script>

 <!-- ------------------------------------------------------------------------ -->
        <!-- Taken from index.html in admin.lte -->
        <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="static/bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="static/bower_components/font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="static/bower_components/Ionicons/css/ionicons.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="static/dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="static/multi_line_chart.css">
  
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->


 <!-- ------------------------------------------------------------------------ -->


<style>

circle {
    stroke: #565352;
    stroke-width: 1;
}
/* div.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: #001;
  color: #F00;
  border-radius: 2px;
  pointer-events: none;
} */
div.tooltip {   
  position: absolute;           
  text-align: center;           
  width: 90px;                  
  height: 58px;                 
  padding: 2px;             
  font: 14px sans-serif;        
  background: yellow;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;         
}

.tooltip-bar {
  position: absolute;           
  text-align: center;           
  width: 90px;                  
  height: 58px;                 
  padding: 2px;             
  font: 14px sans-serif;        
  background: yellow;   
  border: 0px;      
  border-radius: 8px;           
  pointer-events: none;    
}


.legend{
  position: absolute;
}
.d3-tip span {
  color: #ff00c7;
}

.axis path,
  .axis line {
    fill: none;
    stroke: #000;
  }
 
  path.domain {
    stroke: none;
  }
 
  .y .tick line {
    stroke: #ddd;
  }

    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }
    .bar {
            fill: orange;
        }

    .highlight {
            fill: steelblue;
        }

.grid {
    display: grid;
    grid-template-columns: repeat(3, 460px);
    grid-template-rows: 420px 20px 420px 20px 420px 420px 420px 420px;
    grid-gap: 1em;
  }


  .svg-container {
    display: inline-block;
    position: relative;
    width: 100%;
    Height:100%;
    padding-bottom: 70%; /* aspect ratio */
    vertical-align: top;
    overflow: hidden;
}

.svg-content-responsive {
    display: inline-block;
    position: relative;
    width: 100%;
    Height: 100%;
    overflow:scroll;
    top: 00px;
    left: 00px;
}

  header,
  aside,
  article,
  footer {
    background: #eaeaea;
    padding: 1em;
  }


#barAre,#stacked_bar, #bubble, #line1, #line2, #line3, #line4, #line5 , #head-line1, #head-line2, #head-line3, #head-line4, #head-line5, #head-stack-bar{
position: relative;
}

#head-line1, #head-line2, #head-line3, #head-line4, #head-line5, #head-stack-bar{
font-weight: bold;
}

header, footer, #first_sec, #bubble {
    grid-column: 1 / 4;    
  }

  /* Demo Specific Styles */
  body {
    margin: 1em 1em;
    max-width: 950em;
    padding: 1em 0;
  }

  .grid > * {
    display: flex;
    align-items: center;
    justify-content: center;
  }


</style>

</head>

<body>
<!-- fixed menu div start-->



<div id='cssmenu' >
    <select  style="position:fixed; z-index: 100; opacity: 1;" name="navyOp" onchange="update_charts(event)" >
        <option selected="selected">Select Medicine</option>

        {% for item in data2 %}
        <option value="{{item.drugname_generic}}">{{item.drugname_generic}}</option>
        {% endfor %}
      </select>
    </div>
<!-- fixed menu div ends -->
     <div class = "rowhead">
        <div class="row" >
                <div class="col-lg-3 col-xs-6">
                  <!-- small box -->
                  <div class="small-box bg-aqua">
                    <div class="inner">
                      <h3>207 B</h3>
        
                      <p>Av. Spending/Year</p>
                    </div>
                    <div class="icon">
                      <i class="ion ion-bag"></i>
                    </div>
                    <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                  </div>
                </div>
                <!-- ./col -->
                <div class="col-lg-3 col-xs-6">
                  <!-- small box -->
                  <div class="small-box bg-green">
                    <div class="inner">
                      <h3>53<sup style="font-size: 20px">%</sup></h3>
        
                      <p>Average Lobby Amount</p>
                    </div>
                    <div class="icon">
                      <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                  </div>
                </div>
                <!-- ./col -->
                <div class="col-lg-3 col-xs-6">
                  <!-- small box -->
                  <div class="small-box bg-yellow">
                    <div class="inner">
                      <h3>41M</h3>
        
                      <p>User Count</p>
                    </div>
                    <div class="icon">
                      <i class="ion ion-person-add"></i>
                    </div>
                    <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                  </div>
                </div>
                <!-- ./col -->
                <div class="col-lg-3 col-xs-6">
                  <!-- small box -->
                  <div class="small-box bg-red">
                    <div class="inner">
                      <h3>165</h3>
        
                      <p>No. of Medicines</p>
                    </div>
                    <div class="icon">
                      <i class="ion ion-pie-graph"></i>
                    </div>
                    <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                  </div>
                </div>
                <!-- ./col -->
              </div>

            </div>

        <button type="button" id="w1" onclick="onclick_donut()">Donut</button>
        <button type="button" id="w2" onclick="onclick_bar()">Bar</button>

        <div id = "head" style="align-content: center; align-items: center">
                <h3 style="position:relative; top: 0px; text-align: center ">Medicare Spending (in $)</h3>
        </div>

<div class="grid" >
    <div id = "first_sec">   

        <div id ="barAre" style="position:relative; width:100%; height:80%;"></div>
        
    </div>
    <!-- <div id ="barAre"></div> -->


    <div id="head_stack_bar" style="position:relative;font-weight: bold">Drug Brand wise Spending Proportions (in $)</div>
    <div id="head-line1" style="position:relative;">Average Out of Pocket Cost Per Low Income User(in $)</div>
    <div id="head-line2" style="position:relative">Average Out of Pocket Cost Per Normal Income User(in $)</div>
    
<div id ="stacked_bar" style="position:relative">

</div>

<div id="line1" style="position:relative">
    <div class="chart-wrapper" id="chart-line1"></div>
  </div>

  <div id="line2" style="position:relative">
    <div class="chart-wrapper" id="chart-line2"></div>
    </div>
  
    <div id="head_line3" style="position:relative; font-weight: bold;">Total Medicare Spending(in $)</div>
    <div id="head-line4" style="position:relative">Total User Count</div>
    <div id="head-line5" style="position:relative">Total Claim Count</div>




    <div id="line3" style="position:relative">
      <div class="chart-wrapper" id="chart-line3"></div>
      </div>


  <div id="line4" style="position:relative">
    <div class="chart-wrapper" id="chart-line4"></div>
    </div>


  <div id="line5" style="position:relative">
    <div class="chart-wrapper" id="chart-line5"></div>
    </div>

<div id="bubble" style="position:relative">
  </div>


</div>

<!------------------------------------- js files copy start --------------------------->

<script>
d3 = d3version4

var data = {{dataa.chart_data | safe}};
/// fixed dropdown handler /////

function update_charts(evnt) {


 function update_stacked_bar(med_name){
  
//appending the svg in div #stacked_bar
d3 = d3version3

var nd = document.getElementById("stacked_bar");
        if (nd.hasChildNodes()){
          d3.select('#stacked_bar').selectAll("svg").remove();
        }
        else{
          console.log("No appended svg was found")
        }
        
            var w = d3.select("#stacked_bar").node().getBoundingClientRect().width
            var h  = d3.select("#stacked_bar").node().getBoundingClientRect().height
            console.log("updating stacked_bar chart -- getting node's dimensions")
            console.log(w)
            console.log(h)

            w1 = w
            h1 = h

            var svg = d3.select("#stacked_bar")
            .append("svg")
            .attr("style","position: absolute;")
                //responsive SVG needs these 2 attributes and no width and height attr
            .attr("preserveAspectRatio", "none")
            .attr("viewBox", "0 0 " + 600 +" " + 730 )
                //class to make it responsive
            .classed("svg-content-responsive", true) 
            .append('g')
            .attr('transform', 'translate(' + 85 + ',' + 50 + ')');

        // get the updated data and draw the graph.
  $.post("", {'caller': 'stacked_bar','data':med_name}, function(data_infunc){
      //use data_infunc to plot stacked bar char
        console.log("input data cols");

      var columns_list = [];
      var dt = [];
        for (var key in data_infunc) {
          if (data_infunc.hasOwnProperty(key)) {
        //console.log(key + " -> " + data_infunc[key]);
              dt.push({year: key})
              for (var key1 in data_infunc[key]){
                console.log(key1 + " -> " + data_infunc[key][key1]);
                columns_list.push(key1)
                dt[dt.length - 1][key1] = data_infunc[key][key1];

          }
        }
    } 
      console.log("yoooooo");
      console.log(dt)
      var columns_list =  new Set(columns_list);
      columns_list = Array.from(columns_list);
      console.log(columns_list);
      list_columns = columns_list;
        //console.log(PrintResults(a));
        //console.log(a.columns);
        console.log("input data stacked bar");
        console.log(data_infunc);
      
        // Transpose the data into layers
        //var keys = dt.columns.slice(1);
        console.log("keyssss")
        //console.log(keys)
        d3 = d3version3
  // Transpose the data into layers
var dataset = d3.layout.stack()(list_columns.map(function(fruit) {
  return dt.map(function(d) {
    return {x:d.year, y: +d[fruit]};
  });
}));


// Set x, y and colors
var x = d3.scale.ordinal()
  .domain(dataset[0].map(function(d) { return (d.x); }))
  .rangeRoundBands([30, 300], 0.08);
// var x = d3.time.scale()
// .domain(d3.extent(data, function (d) { return (d.year); }))
// .range([10, width-10]);

var y = d3.scale.linear()
  .domain([0, d3.max(dataset, function(d) {  return d3.max(d, function(d) { return (d.y0 + d.y); });  })])
  .range([h1, 0]);
 // var global_colors = ['#FF0000', '#FF1100', '#FF2200', '#FF3300', '#FF4400', '#FF5500', '#FF6600', '#FF7700', '#FF8800', '#FF9900', '#FFAA00', '#FFBB00', '#FFCC00', '#FFDD00', '#FFEE00', '#FFFF00', '#EEFF00', '#DDFF00', '#CCFF00', '#BBFF00', '#AAFF00', '#99FF00', '#88FF00', '#77FF00', '#66FF00', '#55FF00', '#44FF00', '#33FF00', '#22FF00', '#11FF00', '#00FF00'];
 var colors = ["#b33040", "#d25c4d", "#f2b447", "#d9d574"];
 //var colors = global_colors.slice(0,list_columns.length);
//var colors = d3.scale.category10();

// Define and draw axes
var yAxis = d3.svg.axis()
  .scale(y)
  .orient("left")
  .ticks(8)
  .tickSize(-320, 0, 0)
  .tickFormat( function(d) { return d } );

var xAxis = d3.svg.axis()
  .scale(x)
  .ticks(5)
  .orient("bottom")
  // .tickFormat(d3.time.format("%Y"));

  svg.append("g")
  .attr("class", "y axis")
  .call(yAxis);
h2 = h1 + 10;
svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + h2 + ")")
  .call(xAxis);

  // Create groups for each series, rects for each segment 
var groups = svg.selectAll("g.cost")
  .data(dataset)
  .enter().append("g")
  .attr("class", "cost")
  .style("fill", function(d, i) { return colors[i]; });

       // Prep the tooltip bits, initial display is hidden
var tooltip = svg.append("g")
  .attr("class", "tooltip-bar")
  .style("display", "none");
    
tooltip.append("rect")
  .style("position","relative")
  .attr("width", 170)
  .attr("height", 100)
  .attr("fill", "yellow")
  .style("opacity", 0.7);

tooltip.append("text")
  .attr("x", 90)
  .attr('y', 30)
  .attr("dy", "1.2em")
  .style("text-anchor", "middle")
  .style("position","relative")
  .attr("font-size", "18px")
  .attr("font-weight", "bold");
        
  var rect = groups.selectAll("rect")
  .data(function(d) { return d; })
  .enter()
  .append("rect")
  .attr("x", function(d) { return x(d.x); })
  .attr("y", function(d) { return y(d.y0 + d.y); })
  .attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); })
  .attr("width", x.rangeBand())
  .on("mouseover", function() {  tooltip.style("display","block"); })
  .on("mouseout", function() { tooltip.style("display", "none"); })
  .on("mousemove", function(d) {

    var xPosition = d3.mouse(this)[0] - 15;
    var yPosition = d3.mouse(this)[1] - 25;
    tooltip.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
    tooltip.select("text").text(d.y);
  });

  
// Draw legend
var legend = svg.selectAll(".legend")
  .data(colors)
  .enter().append("g")
  .attr("class", "legend")
  .attr("transform", function(d, i) { return "translate(30," + (i * 19) + ")"; });
 
legend.append("rect")
  .attr("x", w-(0.37*w))
  .attr("width", w*0.1)
  .attr("height", h*0.1)
  .style("fill", function(d, i) {return colors.slice().reverse()[i];});
 
legend.append("text")
  .attr("x", w-(0.3*w)+30)
  .attr("y", 9)
  .attr("dy", ".35em")
  .style("text-anchor", "start")
  .style("font-weight","bold")
  .text(function(d, i) { 
    switch (i) {
      case 0: return list_columns[0];
      case 1: return list_columns[1];
      case 2: return list_columns[2];
      case 3: return list_columns[3];
    }
  });
////////////legend over/////

     //////////  tooltip  ////////////////
     

});
     /////////////////////////////////

     
  }


function update_line1(med_name){

    console.log("=====  Here inside updatelin1")

    var nd = document.getElementById("chart-line1");
        if (nd.hasChildNodes()){
          d3.select('#chart-line1').selectAll("svg").remove();
          d3.select('#chart-line1').selectAll("div").remove();

        }
        else{
          console.log("No appended svg was found")
        }


  $.post("", {'caller': 'chart_line1','data':med_name}, function(data_infunc) {
console.log("inside update line1")
console.log(data_infunc)

///////// manipulating the data to specific format ////////


var columns_list = [];
      var dt = [];
        for (var key in data_infunc) {
          if (data_infunc.hasOwnProperty(key)) {
        //console.log(key + " -> " + data_infunc[key]);
              dt.push({year: key})
              for (var key1 in data_infunc[key]){
                console.log(key1 + " -> " + data_infunc[key][key1]);
                columns_list.push(key1)
                dt[dt.length - 1][key1] = data_infunc[key][key1];

          }
        }
    } 
      console.log("insided line1 update");
      console.log(dt)
      var columns_list =  new Set(columns_list);
      columns_list = Array.from(columns_list);
      console.log(columns_list);
/////////////////////////////////////////

var column_set = {};

for (var i = 0; i < columns_list.length; i++){
  console.log(columns_list[i]);
  var c = columns_list[i];
  column_set[c] = {column: c};
}
console.log("associative map")
console.log(column_set);

var chart = makeLineChart(dt, 'year', column_set, {xAxis: 'Years', yAxis: 'Amount'});

d3.select("#chart-line1").attr("style","postion:relative;width:100%;height:100%;") 

chart.bind("#chart-line1");
chart.render(); 

});
  }

function update_line2(med_name){

  var nd = document.getElementById("chart-line2");
        if (nd.hasChildNodes()){
          d3.select('#chart-line2').selectAll("svg").remove();
          d3.select('#chart-line2').selectAll("div").remove();

        }
        else{
          console.log("No appended svg was found")
        }


  $.post("", {'caller': 'chart_line2','data':med_name}, function(data_infunc) {
console.log("inside update line2")
console.log(data_infunc)

///////// manipulating the data to specific format ////////


var columns_list = [];
      var dt = [];
        for (var key in data_infunc) {
          if (data_infunc.hasOwnProperty(key)) {
        //console.log(key + " -> " + data_infunc[key]);
              dt.push({year: key})
              for (var key1 in data_infunc[key]){
                console.log(key1 + " -> " + data_infunc[key][key1]);
                columns_list.push(key1)
                dt[dt.length - 1][key1] = data_infunc[key][key1];

          }
        }
    } 
      console.log("insided line2 update");
      console.log(dt)
      var columns_list =  new Set(columns_list);
      columns_list = Array.from(columns_list);
      console.log(columns_list);
/////////////////////////////////////////

var column_set = {};

for (var i = 0; i < columns_list.length; i++){
  console.log(columns_list[i]);
  var c = columns_list[i];
  column_set[c] = {column: c};
}
console.log("associative map")
console.log(column_set);

var chart = makeLineChart(dt, 'year', column_set, {xAxis: 'Years', yAxis: 'Amount'});

d3.select("#chart-line2").attr("style","postion:relative;width:100%;height:100%;") 

chart.bind("#chart-line2");
chart.render(); 

});
  }




  function update_line3(med_name){

var nd = document.getElementById("chart-line3");
      if (nd.hasChildNodes()){
        d3.select('#chart-line3').selectAll("svg").remove();
        d3.select('#chart-line3').selectAll("div").remove();

      }
      else{
        console.log("No appended svg was found")
      }


$.post("", {'caller': 'chart_line3','data':med_name}, function(data_infunc) {
console.log("inside update line3")
console.log(data_infunc)

///////// manipulating the data to specific format ////////


var columns_list = [];
    var dt = [];
      for (var key in data_infunc) {
        if (data_infunc.hasOwnProperty(key)) {
      //console.log(key + " -> " + data_infunc[key]);
            dt.push({year: key})
            for (var key1 in data_infunc[key]){
              console.log(key1 + " -> " + data_infunc[key][key1]);
              columns_list.push(key1)
              dt[dt.length - 1][key1] = data_infunc[key][key1];

        }
      }
  } 
    console.log("insided line3 update");
    console.log(dt)
    var columns_list =  new Set(columns_list);
    columns_list = Array.from(columns_list);
    console.log(columns_list);
/////////////////////////////////////////

var column_set = {};

for (var i = 0; i < columns_list.length; i++){
console.log(columns_list[i]);
var c = columns_list[i];
column_set[c] = {column: c};
}
console.log("associative map")
console.log(column_set);

var chart = makeLineChart(dt, 'year', column_set, {xAxis: 'Years', yAxis: 'Amount'});

d3.select("#chart-line3").attr("style","postion:relative;width:100%;height:100%;") 

chart.bind("#chart-line3");
chart.render(); 

});
}



function update_line4(med_name){

var nd = document.getElementById("chart-line4");
      if (nd.hasChildNodes()){
        d3.select('#chart-line4').selectAll("svg").remove();
        d3.select('#chart-line4').selectAll("div").remove();

      }
      else{
        console.log("No appended svg was found")
      }


$.post("", {'caller': 'chart_line4','data':med_name}, function(data_infunc) {
console.log("inside update line4")
console.log(data_infunc)

///////// manipulating the data to specific format ////////


var columns_list = [];
    var dt = [];
      for (var key in data_infunc) {
        if (data_infunc.hasOwnProperty(key)) {
      //console.log(key + " -> " + data_infunc[key]);
            dt.push({year: key})
            for (var key1 in data_infunc[key]){
              console.log(key1 + " -> " + data_infunc[key][key1]);
              columns_list.push(key1)
              dt[dt.length - 1][key1] = data_infunc[key][key1];

        }
      }
  } 
    console.log("insided line4 update");
    console.log(dt)
    var columns_list =  new Set(columns_list);
    columns_list = Array.from(columns_list);
    console.log(columns_list);
/////////////////////////////////////////

var column_set = {};

for (var i = 0; i < columns_list.length; i++){
console.log(columns_list[i]);
var c = columns_list[i];
column_set[c] = {column: c};
}
console.log("associative map")
console.log(column_set);

var chart = makeLineChart(dt, 'year', column_set, {xAxis: 'Years', yAxis: 'Amount'});

d3.select("#chart-line4").attr("style","postion:relative;width:100%;height:100%;") 

chart.bind("#chart-line4");
chart.render(); 

});
}



function update_line5(med_name){
console.log("its time to wrap up soon ")
var nd = document.getElementById("chart-line5");
      if (nd.hasChildNodes()){
        d3.select('#chart-line5').selectAll("svg").remove();
        d3.select('#chart-line5').selectAll("div").remove();

      }
      else{
        console.log("No appended svg was found")
      }


$.post("", {'caller': 'chart_line5','data':med_name}, function(data_infunc) {
console.log("inside update line5")
console.log(data_infunc)

///////// manipulating the data to specific format ////////


var columns_list = [];
    var dt = [];
      for (var key in data_infunc) {
        if (data_infunc.hasOwnProperty(key)) {
      //console.log(key + " -> " + data_infunc[key]);
            dt.push({year: key})
            for (var key1 in data_infunc[key]){
              console.log(key1 + " -> " + data_infunc[key][key1]);
              columns_list.push(key1)
              dt[dt.length - 1][key1] = data_infunc[key][key1];

        }
      }
  } 
    console.log("insided line5 update");
    console.log(dt)
    var columns_list =  new Set(columns_list);
    columns_list = Array.from(columns_list);
    console.log(columns_list);
/////////////////////////////////////////

var column_set = {};

for (var i = 0; i < columns_list.length; i++){
console.log(columns_list[i]);
var c = columns_list[i];
column_set[c] = {column: c};
}
console.log("associative map")
console.log(column_set);

var chart = makeLineChart(dt, 'year', column_set, {xAxis: 'Years', yAxis: 'Amount'});

d3.select("#chart-line5").attr("style","postion:relative;width:100%;height:100%;") 

chart.bind("#chart-line5");
chart.render(); 

});
}




  

update_stacked_bar(evnt.target.value);
update_line1(evnt.target.value);
update_line2(evnt.target.value);
update_line3(evnt.target.value);
update_line4(evnt.target.value);
update_line5(evnt.target.value);

d3 = d3version4
 }



///////////////////////////////


/////////<!-----------donut.js copy start----------->


function donutChart() {
    var width,
        height,
        margin = {top: 10, right: 10, bottom: 10, left: 10},
        colour = d3.scaleOrdinal(d3.schemeCategory20c), // colour scheme
        variable, // value in data that will dictate proportions on chart
        category, // compare data by
        padAngle, // effectively dictates the gap between slices
        floatFormat = d3.format('.4r'),
        cornerRadius, // sets how rounded the corners are on each slice
        percentFormat = d3.format(',.2%');

    function chart(selection){
        selection.each(function(data) {
            // generate chart

            // ===========================================================================================
            // Set up constructors for making donut. See https://github.com/d3/d3-shape/blob/master/README.md
            var radius = Math.min(width, height) / 2;

            // creates a new pie generator
            var pie = d3.pie()
                .value(function(d) { return (d[variable]); })
                .sort(null);

            // contructs and arc generator. This will be used for the donut. The difference between outer and inner
            // radius will dictate the thickness of the donut
            var arc = d3.arc()
                .outerRadius(radius * 0.8)
                .innerRadius(radius * 0.6)
                .cornerRadius(cornerRadius)
                .padAngle(padAngle);

            // this arc is used for aligning the text labels
            var outerArc = d3.arc()
                .outerRadius(radius * 0.9)
                .innerRadius(radius * 0.9);
            // ===========================================================================================
            var w = d3.select("#barAre").node().getBoundingClientRect().width
            var h  = d3.select("#barAre").node().getBoundingClientRect().height
            console.log(w)
            console.log(h)
            
            w1 = w+200
            h1 = h+200
            // ===========================================================================================
            // append the svg object to the selection
            var svg = selection.append('svg')
                //.attr('width', width + margin.left + margin.right)
                //.attr('height', height + margin.top + margin.bottom)
                .attr("style","position: absolute;")
                //responsive SVG needs these 2 attributes and no width and height attr
                .attr("preserveAspectRatio", "xMidYMid meet")
                .attr("viewBox", "0 0 " +w1 + " " +h1 )
                //class to make it responsive
                .classed("svg-content-responsive", true)
              .append('g')
                .attr('transform', 'translate(' + w1 / 2 + ',' + h1 / 2 + ')');
            // ===========================================================================================

            // ===========================================================================================
            // g elements to keep elements within svg modular
            svg.append('g').attr('class', 'slices');
            svg.append('g').attr('class', 'labelName');
            svg.append('g').attr('class', 'lines');
            // ===========================================================================================

            // ===========================================================================================
            // add and colour the donut slices
            var path = svg.select('.slices')
                .datum(data).selectAll('path')
                .data(pie)
              .enter().append('path')
                .attr('fill', function(d) { return colour(d.data[category]); })
                .attr('d', arc);
            // ===========================================================================================

            // ===========================================================================================
            // add text labels
            var label = svg.select('.labelName').selectAll('text')
                .data(pie)
              .enter().append('text')
                .attr('dy', '.35em')
                .html(function(d) {
                    // add "key: value" for given category. Number inside tspan is bolded in stylesheet.
                    return d.data[category] + ': <tspan>' + (d.data[variable]) + '</tspan>';
                })
                .attr('transform', function(d) {

                    // effectively computes the centre of the slice.
                    // see https://github.com/d3/d3-shape/blob/master/README.md#arc_centroid
                    var pos = outerArc.centroid(d);

                    // changes the point to be on left or right depending on where label is.
                    pos[0] = radius * 0.95 * (midAngle(d) < Math.PI ? 1 : -1);
                    return 'translate(' + pos + ')';
                })
                .style('text-anchor', function(d) {
                    // if slice centre is on the left, anchor text to start, otherwise anchor to end
                    return (midAngle(d)) < Math.PI ? 'start' : 'end';
                });
            // ===========================================================================================

            // ===========================================================================================
            // add lines connecting labels to slice. A polyline creates straight lines connecting several points
            var polyline = svg.select('.lines')
                .selectAll('polyline')
                .data(pie)
              .enter().append('polyline')
                .attr('points', function(d) {

                    // see label transform function for explanations of these three lines.
                    var pos = outerArc.centroid(d);
                    pos[0] = radius * 0.95 * (midAngle(d) < Math.PI ? 1 : -1);
                    return [arc.centroid(d), outerArc.centroid(d), pos]
                });
            // ===========================================================================================

            // ===========================================================================================
            // add tooltip to mouse events on slices and labels
            d3.selectAll('.labelName text, .slices path').call(toolTip);
            // ===========================================================================================

            // ===========================================================================================
            // Functions

            // calculates the angle for the middle of a slice
            function midAngle(d) { return d.startAngle + (d.endAngle - d.startAngle) / 2; }

            // function that creates and adds the tool tip to a selected element
            function toolTip(selection) {

                // add tooltip (svg circle element) when mouse enters label or slice
                selection.on('mouseenter', function (data) {

                    svg.append('text')
                        .attr('class', 'toolCircle')
                        .attr('dy', -15) // hard-coded. can adjust this to adjust text vertical alignment in tooltip
                        .html(toolTipHTML(data)) // add text to the circle.
                        .style('font-size', '.9em')
                        .style('text-anchor', 'middle'); // centres text in tooltip

                    svg.append('circle')
                        .attr('class', 'toolCircle')
                        .attr('r', radius * 0.55) // radius of tooltip circle
                        .style('fill', colour(data.data[category])) // colour based on category mouse is over
                        .style('fill-opacity', 0.35);

                });

                // remove the tooltip when mouse leaves the slice/label
                selection.on('mouseout', function () {
                    d3.selectAll('.toolCircle').remove();
                });
            }

            // function to create the HTML string for the tool tip. Loops through each key in data object
            // and returns the html string key: value
            function toolTipHTML(data) {

                var tip = '',
                    i   = 0;

                for (var key in data.data) {

                    // if value is a number, format it as a percentage
                    var value = (!isNaN(parseFloat(data.data[key]))) ? (data.data[key]) : data.data[key];

                    // leave off 'dy' attr for first tspan so the 'dy' attr on text element works. The 'dy' attr on
                    // tspan effectively imitates a line break.
                    if (i === 0) tip += '<tspan x="0">' + key + ': ' + value + '</tspan>';
                    else tip += '<tspan x="0" dy="1.2em">' + key + ': ' + value + '</tspan>';
                    i++;
                }

                return tip;
            }
            // ===========================================================================================

        });
    }

    // getter and setter functions. See Mike Bostocks post "Towards Reusable Charts" for a tutorial on how this works.
    chart.width = function(value) {
        if (!arguments.length) return width;
        width = value;
        return chart;
    };

    chart.height = function(value) {
        if (!arguments.length) return height;
        height = value;
        return chart;
    };

    chart.margin = function(value) {
        if (!arguments.length) return margin;
        margin = value;
        return chart;
    };

    chart.radius = function(value) {
        if (!arguments.length) return radius;
        radius = value;
        return chart;
    };

    chart.padAngle = function(value) {
        if (!arguments.length) return padAngle;
        padAngle = value;
        return chart;
    };

    chart.cornerRadius = function(value) {
        if (!arguments.length) return cornerRadius;
        cornerRadius = value;
        return chart;
    };

    chart.colour = function(value) {
        if (!arguments.length) return colour;
        colour = value;
        return chart;
    };

    chart.variable = function(value) {
        if (!arguments.length) return variable;
        variable = value;
        return chart;
    };

    chart.category = function(value) {
        if (!arguments.length) return category;
        category = value;
        return chart;
    };

    return chart;
}


function onclick_donut() {

  d3 = d3version4
console.log("donut is here");
d3.select('#barAre').selectAll("svg").remove();
console.log("donut after svg");

console.log("hello",data);

var donut = donutChart()
        .width(960)
        .height(500)
        .cornerRadius(3) // sets how rounded the corners are on each slice
        .padAngle(0.015) // effectively dictates the gap between slices
        .variable('UnitCount2011')
        .category('Medicinename');

        // $.post("", {'data': 'screeplot'}, function(data_infunc){
        //     d3.select('#barAre')
        //             .datum(data_infunc) // bind data to the div
        //             .call(donut); // draw chart in div
        //     });

        d3.select('#barAre')
                .datum(data) // bind data to the div
                .call(donut); // draw chart in div
  ///////////////////  working version start //////////////////////      
    // d3.csv('2011top20.csv', function(error, data) {
    //     if (error) throw error;
    //     d3.select('#barAre')
    //         .datum(data) // bind data to the div
    //         .call(donut); // draw chart in div
    // });
    d3 = d3version3
}
/////////////////// working version end //////////////////


////<!------------donut.js copy end------------->
////<!-----------bar.js copy start----------->



function onclick_bar() {
  d3 = d3version4
console.log("hello bar how are you")
    d3.select('#barAre').selectAll("svg").remove();
console.log("bar after remove");
var w = d3.select("#barAre").node().getBoundingClientRect().width
var h  = d3.select("#barAre").node().getBoundingClientRect().height
console.log(w)
console.log(h)

w1 = w+120
h1 = h+120

var svg = d3.select("#barAre") //container class to make it responsive
.append("svg")
.attr("style","position: absolute;")
//responsive SVG needs these 2 attributes and no width and height attr
.attr("preserveAspectRatio", "xMidYMid meet")
.attr("viewBox", "0 0 " +w1 + " " +h1 )
//class to make it responsive
.classed("svg-content-responsive", true),  
        margin = 20,
        width = w - margin,
        height = h - margin;

    // svg.append("text")
    //    .attr("transform", "translate(300,0)")
    //    .attr("x", 50)
    //    .attr("y", 50)
    //    .attr("font-size", "24px")
    //    .text("Eye Movement Data")   

    var x = d3.scaleBand().range([0, width]).padding(0.4);
        y = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g").attr("style","overflow:scroll")
            .attr("transform","translate(" + 60 + "," + 50 + ")") 
            .attr("style","position:absolute;");

        x.domain(data.map(function(d) { return d.Medicinename; }));
        y.domain([0,d3.max(data, function(d) { return +d.UnitCount2011; })]);
        
        g.append("g")   // g does not have "x" and "y" attributes, but  svg has .------------------------------
         .attr("transform", "translate(0," + height + ")")  
         .call(d3.axisBottom(x))
         .append("text")
         .attr("y", 50)
         .attr("x", 590)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Medicine Name");

        g.append("g").attr("style","overflow: scroll;")
         .call(d3.axisLeft(y).tickFormat(function(d){
             return  d;
         }).ticks(10))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", -20)
         .attr("x",-100)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Fixation Duration");

        g.selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar") //mouseover event is raised when the mouse cursor is moved over an element
         .on("mouseover", onMouseOver) //On selection of bar elements, two new event handlers added, viz. mouseover and mouseout and we are calling the respective functions to handle mouse events
         .on("mouseout", onMouseOut)   //done to apply animation when mouse hovers over a particular bar and goes out
         
         .attr("x", function(d,i) { return  x(d.Medicinename); })
         .attr("y", function(d) { return y(d.UnitCount2011); })
         .attr("width",x.bandwidth())
         .transition()
         .ease(d3.easeLinear)
         .duration(400)
         .delay(function (d, i) {
             return i * 50;
         })
         .attr("height", function(d) { return height - y(d.UnitCount2011); });
    

    //mouseover event handler function
    /*most callback functions in d3, `this` refers to
the current node. For example, if you pass a function to `attr`,
`style`, or `each`, when that function is called, `this` will refer to
the current DOM element.*/
    function onMouseOver(d, i) {
        d3.select(this).attr('class', 'highlight'); // this, is the object that "owns" the JavaScript code
         //selected bar (given by the 'this' object) d3.select(this) creates a 1-element selection containing the current node
        d3.select(this)
          .transition()     // adds animation
          .duration(400)
          .attr('width', x.bandwidth() + 5)
          .attr("y", function(d) { return y(d.UnitCount2011) - 10; })
          .attr("height", function(d) { return height - y(d.UnitCount2011) + 10; });

        g.append("text")
         .attr('class', 'val')
         .attr('x', function() {
             return x(d.Medicinename);
         })
         .attr('y', function() {
             return y(d.UnitCount2011) - 15;
         })
         .text(function() {
             return [d.Condition];  // Value of the text
         });
    }

    //mouseout event handler function
    function onMouseOut(d, i) {
        // use the text label class to remove label on mouseout
        d3.select(this).attr('class', 'bar');
        d3.select(this)
          .transition()     // adds animation
          .duration(400)
          .attr('width', x.bandwidth())
          .attr("y", function(d) { return y(d.UnitCount2011); }) // What if we don't again fix this Value ?
          .attr("height", function(d) { return height - y(d.UnitCount2011); }); // Play with changing the Value

        d3.selectAll('.val')
          .remove()
    }
    d3 = d3version3

}

////<!------------bar.js copy end------------->

function bubble(){

  d3 = d3version3

var width = 960,
    height = 1000,
    padding = 1.5, // separation between same-color nodes
    clusterPadding = 6, // separation between different-color nodes
    maxRadius = 12;

    var width = d3.select("#bubble").node().getBoundingClientRect().width
var height  = d3.select("#bubble").node().getBoundingClientRect().height
width = width + 500
height = height + 500
var color = d3.scale.ordinal()
      .range(["#7A99AC", "#E4002B","#009933","#0000FF", "#bcbd22" ]);
var colors=["#7A99AC", "#E4002B","#009933","#0000FF", "#bcbd22"];

      // "#009933" ,"#0000FF", "#bcbd22"
d3.text('static/bubble.csv', function(error, text) {
  if (error) throw error;
   d3 = d3version3
  
  var colNames = "text,size,group\n" + text;
  var data = d3.csv.parse(colNames);

  data.forEach(function(d) {
    d.size = +d.size;
    console.log(d.size);
  });


//unique cluster/group id's
var cs = [];
data.forEach(function(d){
        if(!cs.contains(d.group)) {
            cs.push(d.group);
            // console.log(group);
        }
});

var n = data.length, // total number of nodes
    m = cs.length; // number of distinct clusters

    console.log(m);

//create clusters and nodes
var clusters = new Array(m);
var nodes = [];
for (var i = 0; i<n; i++){
    nodes.push(create_nodes(data,i));
}
var div = d3.select("body").append("div")   
              .attr("class", "tooltip")               
              .style("opacity", 0)
              .attr("id", "bubble-tooltip-"+0);


var force = d3.layout.force()
    .nodes(nodes)
    .size([width, height])
    .gravity(.02)
    .charge(0)
    .on("tick", tick)
    .start();


var svg = d3.select("#bubble").append("svg")
.attr("style","position: absolute;")
//responsive SVG needs these 2 attributes and no width and height attr
.attr("preserveAspectRatio", "xMidYMid meet")
.attr("viewBox", "0 0 " +width + " " +height )
//class to make it responsive
.classed("svg-content-responsive", true);
    

// var tip = d3.tip().attr('class','d3-tip')
// .html(function(d){
//   return "<span>" + "inbound: " + d.text +  "</span>";});
//   // svg.call(tip);

// var tooltip = d3.select("body")
//     .append("div")
//     .style("position", "absolute")
//     .style("z-index", "10")
//     .style("visibility", "hidden")
//     .style("background", "#E4002B")
//     .text("a simple tooltip");
var node = svg.selectAll("circle")
    .data(nodes)
    .enter().append("g").call(force.drag);


node.append("circle")
    .style("fill", function (d) {
    return color(d.cluster);
    })
    .attr("r", function(d){return (d.radius)});
    

node.append("text")
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return (d.text.substring(0, 4)); });

      node.on("mouseover", function(d) {      
                    div.transition()        
                        .duration(200)      
                        .style("opacity", .9);      
                    div.html(d.text+"<br/>" )  
                        .style("left", (d3.event.pageX) + "px")     
                        .style("top", (d3.event.pageY - 28) + "px");    
                  })                  
                  .on("mouseout", function(d) {       
                    div.transition()        
                        .duration(500)      
                        .style("opacity", 0); 
                  })

// node.on("mouseover", function(d){ tooltip.text(d.text); return tooltip.style("visibility", "visible");
// })
// .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
// node.on("mouseover",tip.show).on("mouseout",tip.hide)

function create_nodes(data,node_counter) {
  var i = cs.indexOf(data[node_counter].group),
      r = Math.sqrt((i + 1) / m * -Math.log(Math.random())) * maxRadius,
      d = {
        cluster: i,
        radius: data[node_counter].size /1000000,
        text: data[node_counter].text,
        x: Math.cos(i / m * 2 * Math.PI) * 200 + width / 2 + Math.random(),
        y: Math.sin(i / m * 2 * Math.PI) * 200 + height / 2 + Math.random()
      };
  if (!clusters[i] || (r > clusters[i].radius)) clusters[i] = d;
  return d;
};

console.log("Appending legend");
var legend = svg.selectAll(".legend")
  .data(colors)
  .enter().append("g")
  .attr("class", "legend")
  .attr("transform", function(d, i) { return "translate(0," + i * 19 + ")"; });
 
legend.append("rect")
  .attr("x", 54)
  .attr("y",0)
  .attr("width", 15)
  .attr("height", 15)
  .style("fill", function(d,i){ return colors[i]});
 
legend.append("text")
  .attr("x", 80)
  .attr("y", 6)
  .attr("dy", ".65em")
  .style("text-anchor", "start")
  .text(function(d, i) { 
    switch (i) {
      case 0: return "2011";
      case 1: return "2012";
      case 2: return "2013";
      case 3: return "2014";
      case 4: return "2015";
    }
  });

function tick(e) {
    node.each(cluster(10 * e.alpha * e.alpha))
        .each(collide(.5))
    .attr("transform", function (d) {
        var k = "translate(" + d.x + "," + d.y + ")";
        return k;
    })

}

// Move d to be adjacent to the cluster node.
function cluster(alpha) {
    return function (d) {
        var cluster = clusters[d.cluster];
        if (cluster === d) return;
        var x = d.x - cluster.x,
            y = d.y - cluster.y,
            l = Math.sqrt(x * x + y * y),
            r = d.radius + cluster.radius;
        if (l != r) {
            l = (l - r) / l * alpha;
            d.x -= x *= l;
            d.y -= y *= l;
            cluster.x += x;
            cluster.y += y;
        }
    };
}

// Resolves collisions between d and all other circles.
function collide(alpha) {
    var quadtree = d3.geom.quadtree(nodes);
    return function (d) {
        var r = d.radius + maxRadius + Math.max(padding, clusterPadding),
            nx1 = d.x - r,
            nx2 = d.x + r,
            ny1 = d.y - r,
            ny2 = d.y + r;
        quadtree.visit(function (quad, x1, y1, x2, y2) {
            if (quad.point && (quad.point !== d)) {
                var x = d.x - quad.point.x,
                    y = d.y - quad.point.y,
                    l = Math.sqrt(x * x + y * y),
                    r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
                if (l < r) {
                    l = (l - r) / l * alpha;
                    d.x -= x *= l;
                    d.y -= y *= l;
                    quad.point.x += x;
                    quad.point.y += y;
                }
            }
            return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
        });
    };
}
});

Array.prototype.contains = function(v) {
    for(var i = 0; i < this.length; i++) {
        if(this[i] === v) return true;
    }
    return false;
};


}


bubble();


</script>

<!------------------------------------- js files copy end ------------------------------->


</body>

</html>